<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriConnect - Chef de Région</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        :root {
            --primary-color: #2e7d32;
            --primary-light: #4caf50;
            --primary-dark: #1b5e20;
            --secondary-color: #ff9800;
            --accent-color: #2196f3;
            --text-color: #333;
            --light-gray: #f5f5f5;
            --border-color: #ddd;
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
            --shadow-hover: 0 8px 16px rgba(0,0,0,0.12);
            --radius: 10px;
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f9f9f9;
            color: var(--text-color);
            display: flex;
            min-height: 100vh;
            line-height: 1.6;
        }
        
        /* Sidebar */
        .sidebar {
            width: 280px;
            background: linear-gradient(to bottom, var(--primary-color), var(--primary-dark));
            color: white;
            height: 100vh;
            position: fixed;
            transition: var(--transition);
            box-shadow: var(--shadow);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .sidebar-header {
            padding: 25px 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            background-color: rgba(0,0,0,0.1);
        }
        
        .sidebar-header h2 {
            font-size: 1.6rem;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .sidebar-header p {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .sidebar-menu {
            padding: 20px 0;
        }
        
        .sidebar-menu ul {
            list-style: none;
        }
        
        .sidebar-menu li {
            padding: 14px 25px;
            transition: var(--transition);
            border-left: 4px solid transparent;
        }
        
        .sidebar-menu li:hover {
            background-color: rgba(255,255,255,0.05);
        }
        
        .sidebar-menu li.active {
            background-color: rgba(255,255,255,0.1);
            border-left: 4px solid var(--secondary-color);
        }
        
        .sidebar-menu a {
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            font-weight: 500;
        }
        
        .sidebar-menu i {
            margin-right: 15px;
            font-size: 1.3rem;
            width: 24px;
            text-align: center;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            transition: var(--transition);
        }
        
        /* Top Bar */
        .top-bar {
            background-color: white;
            padding: 18px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .user-info {
            display: flex;
            align-items: center;
        }
        
        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-light), var(--accent-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 12px;
            box-shadow: var(--shadow);
        }
        
        .user-details h3 {
            font-size: 1.1rem;
            margin-bottom: 2px;
        }
        
        .user-details p {
            font-size: 0.85rem;
            color: #666;
        }
        
        .profile-btn {
            background-color: var(--light-gray);
            border: none;
            padding: 10px 18px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            font-weight: 500;
            transition: var(--transition);
            margin-right: 10px;
        }
        
        .profile-btn:hover {
            background-color: #e0e0e0;
        }
        
        .logout-btn {
            background-color: var(--light-gray);
            border: none;
            padding: 10px 18px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            font-weight: 500;
            transition: var(--transition);
        }
        
        .logout-btn:hover {
            background-color: #e0e0e0;
        }
        
        .logout-btn i, .profile-btn i {
            margin-right: 8px;
        }
        
        /* Content Area */
        .content {
            padding: 30px;
        }
        
        .page-title {
            margin-bottom: 25px;
            color: var(--primary-dark);
            font-size: 1.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
        }
        
        .page-title i {
            margin-right: 12px;
            color: var(--primary-color);
        }
        
        /* Dashboard Cards */
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }
        
        .card {
            background-color: white;
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
        }
        
        .card-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 18px;
            font-size: 1.6rem;
            box-shadow: var(--shadow);
        }
        
        .card-icon.blue {
            background-color: #e3f2fd;
            color: #1976d2;
        }
        
        .card-icon.green {
            background-color: #e8f5e9;
            color: var(--primary-color);
        }
        
        .card-icon.orange {
            background-color: #fff3e0;
            color: var(--secondary-color);
        }
        
        .card-icon.purple {
            background-color: #f3e5f5;
            color: #7b1fa2;
        }
        
        .card-value {
            font-size: 2.2rem;
            font-weight: 700;
            margin: 10px 0;
            color: var(--text-color);
        }
        
        .card-title {
            color: #666;
            font-size: 0.95rem;
        }
        
        /* Forms */
        .form-container {
            background-color: white;
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
            max-width: 850px;
        }
        
        .form-header {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .form-header h2 {
            color: var(--primary-dark);
            font-size: 1.5rem;
            display: flex;
            align-items: center;
        }
        
        .form-header h2 i {
            margin-right: 10px;
            color: var(--primary-color);
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            flex: 1;
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn i {
            margin-right: 8px;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        /* Tables */
        .table-container {
            background-color: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        th {
            background-color: var(--light-gray);
            font-weight: 600;
            color: #555;
        }
        
        tr:hover {
            background-color: #f9f9f9;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .btn-action {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            display: inline-flex;
            align-items: center;
            transition: var(--transition);
        }
        
        .btn-action i {
            margin-right: 5px;
        }
        
        .btn-edit {
            background-color: #e3f2fd;
            color: #1976d2;
        }
        
        .btn-edit:hover {
            background-color: #bbdefb;
        }
        
        .btn-delete {
            background-color: #ffebee;
            color: #d32f2f;
        }
        
        .btn-delete:hover {
            background-color: #ffcdd2;
        }
        
        .btn-view {
            background-color: #e8f5e9;
            color: var(--primary-color);
        }
        
        .btn-view:hover {
            background-color: #c8e6c9;
        }
        
        /* Search Bar */
        .search-bar {
            display: flex;
            margin-bottom: 25px;
            gap: 15px;
        }
        
        .search-input {
            flex: 1;
            padding: 12px 18px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
        }
        
        .filter-select {
            padding: 12px 18px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: white;
            font-size: 1rem;
            min-width: 200px;
        }
        
        /* Region Selection */
        .region-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .region-card {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            text-align: center;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }
        
        .region-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }
        
        .region-card.active {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
        }
        
        .region-icon {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 1.8rem;
            color: white;
        }
        
        .region-nord .region-icon { background: #2196f3; }
        .region-sud .region-icon { background: #ff9800; }
        .region-est .region-icon { background: #4caf50; }
        .region-ouest .region-icon { background: #9c27b0; }
        
        .region-card h3 {
            margin-bottom: 10px;
            color: var(--text-color);
        }
        
        .region-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--primary-color);
        }
        
        .stat-label {
            color: #666;
            font-size: 0.8rem;
        }
        
        /* Delegates Grid */
        .delegates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .delegate-card {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .delegate-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
        }
        
        .delegate-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .delegate-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-light), var(--accent-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 15px;
        }
        
        .delegate-info h4 {
            margin-bottom: 5px;
            color: var(--text-color);
        }
        
        .delegate-info p {
            color: #666;
            font-size: 0.9rem;
        }
        
        .delegate-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        .delegate-stat {
            text-align: center;
            padding: 10px;
            background: var(--light-gray);
            border-radius: 6px;
        }
        
        .delegate-stat .value {
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--primary-color);
        }
        
        .delegate-stat .label {
            font-size: 0.8rem;
            color: #666;
        }
        
        /* Report Cards */
        .reports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }
        
        .report-card {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .report-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
        }
        
        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .report-farmer {
            font-weight: 600;
            color: var(--primary-dark);
        }
        
        .report-date {
            color: #666;
            font-size: 0.9rem;
        }
        
        .report-delegate {
            color: #666;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .report-content {
            margin-bottom: 15px;
        }
        
        .report-description {
            margin-bottom: 10px;
            line-height: 1.5;
        }
        
        .report-ordonnance {
            background-color: var(--light-gray);
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
        }
        
        .report-ordonnance h5 {
            margin-bottom: 8px;
            color: var(--primary-dark);
        }
        
        .report-photo {
            margin-top: 15px;
            text-align: center;
        }
        
        .report-photo img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 6px;
            box-shadow: var(--shadow);
        }
        
        /* Farmers List */
        .farmers-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }
        
        .farmer-card {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .farmer-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
        }
        
        .farmer-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .farmer-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-light));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 15px;
        }
        
        .farmer-info h4 {
            margin-bottom: 5px;
            color: var(--text-color);
        }
        
        .farmer-info p {
            color: #666;
            font-size: 0.9rem;
        }
        
        .farmer-details {
            margin-top: 10px;
        }
        
        .farmer-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .farmer-detail .label {
            color: #666;
        }
        
        .farmer-detail .value {
            font-weight: 500;
        }
        
        /* Export Button */
        .export-section {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
        }
        
        .btn-export {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            font-weight: 500;
            transition: var(--transition);
        }
        
        .btn-export:hover {
            background-color: var(--primary-dark);
        }
        
        /* Alert */
        .alert {
            padding: 16px 20px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
        }
        
        .alert-success {
            background-color: #e8f5e9;
            color: var(--primary-color);
            border-left: 4px solid var(--primary-color);
        }
        
        .alert i {
            margin-right: 12px;
            font-size: 1.3rem;
            margin-top: 2px;
        }
        
        .alert-content h4 {
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .alert-content p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: white;
            border-radius: var(--radius);
            width: 90%;
            max-width: 800px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: modalFadeIn 0.3s;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            color: var(--primary-dark);
            font-size: 1.4rem;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            transition: var(--transition);
        }
        
        .close-modal:hover {
            color: var(--text-color);
        }
        
        .modal-body {
            padding: 25px;
        }
        
        .modal-footer {
            padding: 15px 25px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        /* Toast Notification */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
        }
        
        .toast {
            background-color: white;
            border-radius: 6px;
            padding: 15px 20px;
            margin-bottom: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            min-width: 300px;
            animation: toastSlideIn 0.3s;
            border-left: 4px solid var(--primary-color);
        }
        
        @keyframes toastSlideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .toast.success {
            border-left-color: var(--primary-color);
        }
        
        .toast.error {
            border-left-color: #d32f2f;
        }
        
        .toast i {
            margin-right: 10px;
            font-size: 1.2rem;
        }
        
        .toast.success i {
            color: var(--primary-color);
        }
        
        .toast.error i {
            color: #d32f2f;
        }
        
        .toast-content h4 {
            font-size: 1rem;
            margin-bottom: 5px;
        }
        
        .toast-content p {
            font-size: 0.9rem;
            color: #666;
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .sidebar {
                width: 80px;
            }
            
            .sidebar-header h2, .sidebar-menu span {
                display: none;
            }
            
            .sidebar-menu i {
                margin-right: 0;
                font-size: 1.5rem;
            }
            
            .main-content {
                margin-left: 80px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
        }
        
        @media (max-width: 768px) {
            .cards-container {
                grid-template-columns: 1fr;
            }
            
            .region-selection {
                grid-template-columns: 1fr;
            }
            
            .delegates-grid, .reports-grid, .farmers-list {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .search-bar {
                flex-direction: column;
            }
            
            .filter-select {
                min-width: auto;
            }
        }
        
        /* Animation for page transitions */
        .page {
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Profile page */
        .profile-container {
            display: flex;
            gap: 30px;
        }
        
        .profile-sidebar {
            width: 250px;
            background-color: white;
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            height: fit-content;
        }
        
        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-light), var(--accent-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2.5rem;
            font-weight: bold;
            margin: 0 auto 20px;
            box-shadow: var(--shadow);
        }
        
        .profile-info {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .profile-info h3 {
            font-size: 1.3rem;
            margin-bottom: 5px;
            color: var(--primary-dark);
        }
        
        .profile-info p {
            color: #666;
            font-size: 0.9rem;
        }
        
        .profile-menu {
            list-style: none;
        }
        
        .profile-menu li {
            padding: 12px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 5px;
        }
        
        .profile-menu li.active {
            background-color: var(--light-gray);
            color: var(--primary-color);
            font-weight: 500;
        }
        
        .profile-menu li:hover:not(.active) {
            background-color: #f9f9f9;
        }
        
        .profile-content {
            flex: 1;
        }
        
        .profile-section {
            background-color: white;
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
        }
        
        .profile-section h3 {
            color: var(--primary-dark);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>AgriConnect</h2>
            <p>Chef de Région</p>
        </div>
        <div class="sidebar-menu">
            <ul>
                <li class="active">
                    <a href="#dashboard">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Tableau de Bord</span>
                    </a>
                </li>
                <li>
                    <a href="#selection-region">
                        <i class="fas fa-map-marked-alt"></i>
                        <span>Sélection Région</span>
                    </a>
                </li>
                <li>
                    <a href="#liste-delegues">
                        <i class="fas fa-users"></i>
                        <span>Liste Délégués</span>
                    </a>
                </li>
                <li>
                    <a href="#rapports-delegues">
                        <i class="fas fa-file-alt"></i>
                        <span>Rapports Délégués</span>
                    </a>
                </li>
                <li>
                    <a href="#liste-fermiers">
                        <i class="fas fa-user-friends"></i>
                        <span>Fermiers par Délégué</span>
                    </a>
                </li>
                <li>
                    <a href="#profil">
                        <i class="fas fa-user-cog"></i>
                        <span>Mon Profil</span>
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="user-info">
                <div class="user-avatar">AR</div>
                <div class="user-details">
                    <h3>Ahmed Rachedi</h3>
                    <p>Chef de Région</p>
                </div>
            </div>
            <div>
                <button class="" id="profile-btn">
                   
                </button>
                <button class="logout-btn" onclick="window.location.href='../../login.html'">
                    <i class="fas fa-sign-out-alt"></i>
                    Déconnexion
                </button>
            </div>
        </div>

        <!-- Content Area -->
        <div class="content">
            <!-- Dashboard Page -->
            <div id="dashboard" class="page active">
                <h1 class="page-title"><i class="fas fa-tachometer-alt"></i> Tableau de Bord Régional</h1>
                
                <!-- Statistics Cards -->
                <div class="cards-container">
                    <div class="card">
                        <div class="card-icon blue">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="card-value" id="total-delegates">0</div>
                        <div class="card-title">Délégués Techniques</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon green">
                            <i class="fas fa-user-friends"></i>
                        </div>
                        <div class="card-value" id="total-farmers">0</div>
                        <div class="card-title">Fermiers Totaux</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon orange">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="card-value" id="total-reports">0</div>
                        <div class="card-title">Rapports Cette Semaine</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon purple">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="card-value" id="wilayas-covered">0</div>
                        <div class="card-title">Wilayas Couvertes</div>
                    </div>
                </div>
                
                <!-- Region Overview -->
                <div class="form-container">
                    <div class="form-header">
                        <h2><i class="fas fa-chart-bar"></i> Aperçu des Régions</h2>
                    </div>
                    <div class="region-selection">
                        <div class="region-card region-nord" data-region="nord">
                            <div class="region-icon">
                                <i class="fas fa-mountain"></i>
                            </div>
                            <h3>Région Nord</h3>
                            <p>16 Wilayas</p>
                            <div class="region-stats">
                                <div class="stat-item">
                                    <div class="stat-value" id="nord-delegates">0</div>
                                    <div class="stat-label">Délégués</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="nord-reports">0</div>
                                    <div class="stat-label">Rapports</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="region-card region-sud" data-region="sud">
                            <div class="region-icon">
                                <i class="fas fa-sun"></i>
                            </div>
                            <h3>Région Sud</h3>
                            <p>12 Wilayas</p>
                            <div class="region-stats">
                                <div class="stat-item">
                                    <div class="stat-value" id="sud-delegates">0</div>
                                    <div class="stat-label">Délégués</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="sud-reports">0</div>
                                    <div class="stat-label">Rapports</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="region-card region-est" data-region="est">
                            <div class="region-icon">
                                <i class="fas fa-tree"></i>
                            </div>
                            <h3>Région Est</h3>
                            <p>14 Wilayas</p>
                            <div class="region-stats">
                                <div class="stat-item">
                                    <div class="stat-value" id="est-delegates">0</div>
                                    <div class="stat-label">Délégués</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="est-reports">0</div>
                                    <div class="stat-label">Rapports</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="region-card region-ouest" data-region="ouest">
                            <div class="region-icon">
                                <i class="fas fa-tint"></i>
                            </div>
                            <h3>Région Ouest</h3>
                            <p>16 Wilayas</p>
                            <div class="region-stats">
                                <div class="stat-item">
                                    <div class="stat-value" id="ouest-delegates">0</div>
                                    <div class="stat-label">Délégués</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="ouest-reports">0</div>
                                    <div class="stat-label">Rapports</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Activity -->
                <div class="form-container">
                    <div class="form-header">
                        <h2><i class="fas fa-history"></i> Activité Récente</h2>
                    </div>
                    <div id="recent-activities">
                        <!-- Activities will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Sélection Région Page -->
            <div id="selection-region" class="page" style="display: none;">
                <h1 class="page-title"><i class="fas fa-map-marked-alt"></i> Sélection de la Région</h1>
                
                <div class="form-container">
                    <div class="form-header">
                        <h2><i class="fas fa-compass"></i> Choisissez une Région</h2>
                    </div>
                    
                    <div class="region-selection">
                        <div class="region-card region-nord" data-region="nord">
                            <div class="region-icon">
                                <i class="fas fa-mountain"></i>
                            </div>
                            <h3>Région Nord</h3>
                            <p>16 Wilayas</p>
                            <div class="region-stats">
                                <div class="stat-item">
                                    <div class="stat-value">16</div>
                                    <div class="stat-label">Wilayas</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="nord-delegates-select">0</div>
                                    <div class="stat-label">Délégués</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="region-card region-sud" data-region="sud">
                            <div class="region-icon">
                                <i class="fas fa-sun"></i>
                            </div>
                            <h3>Région Sud</h3>
                            <p>12 Wilayas</p>
                            <div class="region-stats">
                                <div class="stat-item">
                                    <div class="stat-value">12</div>
                                    <div class="stat-label">Wilayas</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="sud-delegates-select">0</div>
                                    <div class="stat-label">Délégués</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="region-card region-est" data-region="est">
                            <div class="region-icon">
                                <i class="fas fa-tree"></i>
                            </div>
                            <h3>Région Est</h3>
                            <p>14 Wilayas</p>
                            <div class="region-stats">
                                <div class="stat-item">
                                    <div class="stat-value">14</div>
                                    <div class="stat-label">Wilayas</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="est-delegates-select">0</div>
                                    <div class="stat-label">Délégués</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="region-card region-ouest" data-region="ouest">
                            <div class="region-icon">
                                <i class="fas fa-tint"></i>
                            </div>
                            <h3>Région Ouest</h3>
                            <p>16 Wilayas</p>
                            <div class="region-stats">
                                <div class="stat-item">
                                    <div class="stat-value">16</div>
                                    <div class="stat-label">Wilayas</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value" id="ouest-delegates-select">0</div>
                                    <div class="stat-label">Délégués</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="selected-region-info" style="display: none; margin-top: 30px;">
                        <div class="form-header">
                            <h2><i class="fas fa-info-circle"></i> Informations sur la Région Sélectionnée</h2>
                        </div>
                        <div id="region-details">
                            <!-- Region details will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Liste Délégués Page -->
            <div id="liste-delegues" class="page" style="display: none;">
                <h1 class="page-title"><i class="fas fa-users"></i> Liste des Délégués Techniques</h1>
                
                <!-- Region Filter -->
                <div class="search-bar">
                    <select class="filter-select" id="filter-region-delegates">
                        <option value="">Toutes les régions</option>
                        <option value="nord">Région Nord</option>
                        <option value="sud">Région Sud</option>
                        <option value="est">Région Est</option>
                        <option value="ouest">Région Ouest</option>
                    </select>
                    <select class="filter-select" id="filter-wilaya-delegates">
                        <option value="">Toutes les wilayas</option>
                        <!-- Wilayas will be loaded here -->
                    </select>
                    <input type="text" class="search-input" id="search-delegate" placeholder="Rechercher un délégué...">
                </div>
                
                <!-- Delegates Grid -->
                <div class="delegates-grid" id="delegates-grid">
                    <!-- Delegates will be loaded here -->
                </div>
            </div>
            
            <!-- Rapports Délégués Page -->
            <div id="rapports-delegues" class="page" style="display: none;">
                <h1 class="page-title"><i class="fas fa-file-alt"></i> Rapports des Délégués</h1>
                
                <!-- Export Button -->
                <div class="export-section">
                    <button class="btn-export" id="export-reports">
                        <i class="fas fa-download"></i> Exporter en PDF
                    </button>
                </div>
                
                <!-- Search and Filter -->
                <div class="search-bar">
                    <select class="filter-select" id="filter-region-reports">
                        <option value="">Toutes les régions</option>
                        <option value="nord">Région Nord</option>
                        <option value="sud">Région Sud</option>
                        <option value="est">Région Est</option>
                        <option value="ouest">Région Ouest</option>
                    </select>
                    <select class="filter-select" id="filter-delegate-reports">
                        <option value="">Tous les délégués</option>
                        <!-- Delegates will be loaded here -->
                    </select>
                    <select class="filter-select" id="filter-date-reports">
                        <option value="">Toutes les dates</option>
                        <option value="today">Aujourd'hui</option>
                        <option value="week">Cette semaine</option>
                        <option value="month">Ce mois</option>
                    </select>
                </div>
                
                <!-- Reports Grid -->
                <div class="reports-grid" id="reports-grid">
                    <!-- Reports will be loaded here -->
                </div>
            </div>
            
            <!-- Fermiers par Délégué Page -->
            <div id="liste-fermiers" class="page" style="display: none;">
                <h1 class="page-title"><i class="fas fa-user-friends"></i> Fermiers par Délégué</h1>
                
                <!-- Delegate Selection -->
                <div class="search-bar">
                    <select class="filter-select" id="filter-delegate-farmers">
                        <option value="">Sélectionner un délégué</option>
                        <!-- Delegates will be loaded here -->
                    </select>
                    <select class="filter-select" id="filter-region-farmers">
                        <option value="">Toutes les régions</option>
                        <option value="nord">Région Nord</option>
                        <option value="sud">Région Sud</option>
                        <option value="est">Région Est</option>
                        <option value="ouest">Région Ouest</option>
                    </select>
                    <input type="text" class="search-input" id="search-farmer-delegate" placeholder="Rechercher un fermier...">
                </div>
                
                <!-- Farmers List -->
                <div class="farmers-list" id="farmers-list">
                    <!-- Farmers will be loaded here -->
                </div>
            </div>
            
            <!-- Profil Page -->
            <div id="profil" class="page" style="display: none;">
                <h1 class="page-title"><i class="fas fa-user-cog"></i> Mon Profil</h1>
                
                <div class="profile-container">
                    <div class="profile-sidebar">
                        <div class="profile-avatar">AR</div>
                        <div class="profile-info">
                            <h3>Ahmed Rachedi</h3>
                            <p>Chef de Région</p>
                        </div>
                        <ul class="profile-menu">
                            <li class="active" data-tab="info">Informations Personnelles</li>
                            <li data-tab="security">Sécurité</li>
                        </ul>
                    </div>
                    
                    <div class="profile-content">
                        <div class="profile-section" id="info-tab">
                            <h3>Informations Personnelles</h3>
                            <form id="profile-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="profile-nom">Nom</label>
                                        <input type="text" id="profile-nom" class="form-control" value="Rachedi">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="profile-prenom">Prénom</label>
                                        <input type="text" id="profile-prenom" class="form-control" value="Ahmed">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="profile-email">Email</label>
                                    <input type="email" id="profile-email" class="form-control" value="ahmed.rachedi@agriconnect.dz">
                                </div>
                                
                                <div class="form-group">
                                    <label for="profile-telephone">Téléphone</label>
                                    <input type="tel" id="profile-telephone" class="form-control" value="+213 555 789 012">
                                </div>
                                
                                <div class="form-group">
                                    <label for="profile-region">Région Responsable</label>
                                    <select id="profile-region" class="form-control">
                                        <option value="nord">Région Nord</option>
                                        <option value="sud">Région Sud</option>
                                        <option value="est">Région Est</option>
                                        <option value="ouest">Région Ouest</option>
                                    </select>
                                </div>
                                
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> Enregistrer les modifications
                                </button>
                            </form>
                        </div>
                        
                        <div class="profile-section" id="security-tab" style="display: none;">
                            <h3>Sécurité</h3>
                            <form id="security-form">
                                <div class="form-group">
                                    <label for="current-password">Mot de passe actuel</label>
                                    <input type="password" id="current-password" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="new-password">Nouveau mot de passe</label>
                                    <input type="password" id="new-password" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label for="confirm-password">Confirmer le nouveau mot de passe</label>
                                    <input type="password" id="confirm-password" class="form-control">
                                </div>
                                
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-key"></i> Changer le mot de passe
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- View Report Modal -->
    <div id="viewReportModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Détails du Rapport</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="report-details">
                    <!-- Report details will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="closeViewReport">Fermer</button>
            </div>
        </div>
    </div>

    <script>
        // Data management
        let delegates = JSON.parse(localStorage.getItem('delegates')) || [];
        let farmers = JSON.parse(localStorage.getItem('farmers')) || [];
        let reports = JSON.parse(localStorage.getItem('reports')) || [];
        let selectedRegion = null;
        
        // List of 58 wilayas in Algeria grouped by region
        const wilayasByRegion = {
            nord: [
                "Alger", "Blida", "Tizi Ouzou", "Béjaïa", "Boumerdès", "Tipaza", "Bouira", "Medea", "Aïn Defla", "Chlef",
                "Tissemsilt", "Relizane", "Mostaganem", "Oran", "Mascara", "Saïda", "Sidi Bel Abbès", "Tlemcen", "Aïn Témouchent"
            ],
            sud: [
                "Adrar", "Béchar", "Tindouf", "Bordj Badji Mokhtar", "Timimoun", "Ouled Djellal", "Béni Abbès", "In Salah", "In Guezzam",
                "Touggourt", "Djanet", "El M'Ghair", "El Menia", "Ghardaïa", "El Oued", "Ouargla", "Illizi", "Tamanrasset"
            ],
            est: [
                "Annaba", "Skikda", "El Tarf", "Souk Ahras", "Guelma", "Constantine", "Mila", "Jijel", "Oum El Bouaghi", "Batna",
                "Khenchela", "Tébessa", "Sétif", "Bordj Bou Arréridj"
            ],
            ouest: [
                "Tlemcen", "Sidi Bel Abbès", "Mascara", "Mostaganem", "Oran", "Aïn Témouchent", "Relizane", "Saïda", "Tiaret", "Tissemsilt"
            ]
        };
        
        // All wilayas
        const allWilayas = [...new Set([
            ...wilayasByRegion.nord,
            ...wilayasByRegion.sud,
            ...wilayasByRegion.est,
            ...wilayasByRegion.ouest
        ])];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Load data
            loadDelegates();
            loadFarmers();
            loadReports();
            updateDashboard();
            loadRecentActivities();
            
            // Setup event listeners
            setupEventListeners();
            
            // Load wilayas
            loadWilayas();
            
            // Show initial page
            showPage('dashboard');
        });

        // Load wilayas into select elements
        function loadWilayas() {
            const wilayaSelects = [
                document.getElementById('filter-wilaya-delegates')
            ];
            
            wilayaSelects.forEach(select => {
                if (select) {
                    allWilayas.forEach(wilaya => {
                        const option = document.createElement('option');
                        option.value = wilaya;
                        option.textContent = wilaya;
                        select.appendChild(option);
                    });
                }
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Navigation
            const menuItems = document.querySelectorAll('.sidebar-menu li');
            menuItems.forEach(item => {
                item.addEventListener('click', function() {
                    menuItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    
                    const targetId = this.querySelector('a').getAttribute('href').substring(1);
                    showPage(targetId);
                });
            });
            
            // Profile button
            document.getElementById('profile-btn').addEventListener('click', function() {
                showPage('profil');
                document.querySelectorAll('.sidebar-menu li').forEach(item => item.classList.remove('active'));
                document.querySelector('.sidebar-menu a[href="#profil"]').parentElement.classList.add('active');
            });
            
            // Region selection
            document.querySelectorAll('.region-card').forEach(card => {
                card.addEventListener('click', function() {
                    const region = this.dataset.region;
                    selectRegion(region);
                });
            });
            
            // Form submissions
            document.getElementById('profile-form').addEventListener('submit', function(e) {
                e.preventDefault();
                updateProfile();
            });
            
            document.getElementById('security-form').addEventListener('submit', function(e) {
                e.preventDefault();
                updatePassword();
            });
            
            // Search and filter functionality
            document.getElementById('search-delegate').addEventListener('input', function() {
                filterDelegates();
            });
            
            document.getElementById('filter-region-delegates').addEventListener('change', function() {
                filterDelegates();
                updateWilayasFilter();
            });
            
            document.getElementById('filter-wilaya-delegates').addEventListener('change', function() {
                filterDelegates();
            });
            
            document.getElementById('filter-region-reports').addEventListener('change', function() {
                filterReports();
                updateDelegatesFilter();
            });
            
            document.getElementById('filter-delegate-reports').addEventListener('change', function() {
                filterReports();
            });
            
            document.getElementById('filter-date-reports').addEventListener('change', function() {
                filterReports();
            });
            
            document.getElementById('filter-delegate-farmers').addEventListener('change', function() {
                loadFarmersByDelegate();
            });
            
            document.getElementById('filter-region-farmers').addEventListener('change', function() {
                loadFarmersByDelegate();
            });
            
            document.getElementById('search-farmer-delegate').addEventListener('input', function() {
                filterFarmersByDelegate();
            });
            
            // Export button
            document.getElementById('export-reports').addEventListener('click', function() {
                exportReportsToPDF();
            });
            
            // Profile menu
            document.querySelectorAll('.profile-menu li').forEach(item => {
                item.addEventListener('click', function() {
                    document.querySelectorAll('.profile-menu li').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    
                    const tabId = this.dataset.tab + '-tab';
                    document.querySelectorAll('.profile-section').forEach(section => {
                        section.style.display = 'none';
                    });
                    document.getElementById(tabId).style.display = 'block';
                });
            });
            
            // Modal functionality
            setupModals();
        }

        // Setup modal functionality
        function setupModals() {
            const viewModal = document.getElementById('viewReportModal');
            const closeButtons = document.querySelectorAll('.close-modal');
            
            closeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    viewModal.style.display = 'none';
                });
            });
            
            document.getElementById('closeViewReport').addEventListener('click', function() {
                viewModal.style.display = 'none';
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(e) {
                if (e.target === viewModal) {
                    viewModal.style.display = 'none';
                }
            });
        }

        // Show page with animation
        function showPage(pageId) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.style.display = 'none');
            
            document.getElementById(pageId).style.display = 'block';
            
            // Special handling for certain pages
            if (pageId === 'liste-delegues') {
                loadDelegatesGrid();
            } else if (pageId === 'rapports-delegues') {
                loadReportsGrid();
            } else if (pageId === 'liste-fermiers') {
                loadDelegatesForFarmers();
                loadFarmersByDelegate();
            } else if (pageId === 'selection-region') {
                updateRegionSelectionStats();
            }
        }

        // Load delegates from localStorage
        function loadDelegates() {
            // If no delegates in localStorage, create sample data
            if (delegates.length === 0) {
                delegates = [
                    {
                        id: 1,
                        nom: "Tekfa",
                        prenom: "Mohamed",
                        email: "mohamed.tekfa@agriconnect.dz",
                        telephone: "+213 555 123 456",
                        wilaya: "Alger",
                        region: "nord",
                        farmersCount: 12,
                        reportsCount: 8,
                        dateAdded: new Date().toISOString()
                    },
                    {
                        id: 2,
                        nom: "Bouzid",
                        prenom: "Karim",
                        email: "karim.bouzid@agriconnect.dz",
                        telephone: "+213 555 234 567",
                        wilaya: "Oran",
                        region: "ouest",
                        farmersCount: 8,
                        reportsCount: 5,
                        dateAdded: new Date().toISOString()
                    },
                    {
                        id: 3,
                        nom: "Mansour",
                        prenom: "Fatima",
                        email: "fatima.mansour@agriconnect.dz",
                        telephone: "+213 555 345 678",
                        wilaya: "Constantine",
                        region: "est",
                        farmersCount: 15,
                        reportsCount: 10,
                        dateAdded: new Date().toISOString()
                    },
                    {
                        id: 4,
                        nom: "Khaldi",
                        prenom: "Youssef",
                        email: "youssef.khaldi@agriconnect.dz",
                        telephone: "+213 555 456 789",
                        wilaya: "Ouargla",
                        region: "sud",
                        farmersCount: 6,
                        reportsCount: 4,
                        dateAdded: new Date().toISOString()
                    }
                ];
                localStorage.setItem('delegates', JSON.stringify(delegates));
            }
        }

        // Load farmers from localStorage
        function loadFarmers() {
            farmers = JSON.parse(localStorage.getItem('farmers')) || [];
        }

        // Load reports from localStorage
        function loadReports() {
            reports = JSON.parse(localStorage.getItem('reports')) || [];
        }

        // Update dashboard statistics
        function updateDashboard() {
            document.getElementById('total-delegates').textContent = delegates.length;
            document.getElementById('total-farmers').textContent = farmers.length;
            
            // Calculate weekly reports
            const oneWeekAgo = new Date();
            oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
            const weeklyReports = reports.filter(report => new Date(report.date) >= oneWeekAgo);
            document.getElementById('total-reports').textContent = weeklyReports.length;
            
            // Calculate wilayas covered
            const wilayas = [...new Set(delegates.map(delegate => delegate.wilaya))].filter(wilaya => wilaya);
            document.getElementById('wilayas-covered').textContent = wilayas.length;
            
            // Update region stats
            updateRegionStats();
        }

        // Update region statistics
        function updateRegionStats() {
            const regions = ['nord', 'sud', 'est', 'ouest'];
            
            regions.forEach(region => {
                const regionDelegates = delegates.filter(d => d.region === region);
                const regionReports = reports.filter(r => {
                    const delegate = delegates.find(d => d.id === r.delegateId);
                    return delegate && delegate.region === region;
                });
                
                document.getElementById(`${region}-delegates`).textContent = regionDelegates.length;
                document.getElementById(`${region}-reports`).textContent = regionReports.length;
            });
        }

        // Update region selection stats
        function updateRegionSelectionStats() {
            const regions = ['nord', 'sud', 'est', 'ouest'];
            
            regions.forEach(region => {
                const regionDelegates = delegates.filter(d => d.region === region);
                document.getElementById(`${region}-delegates-select`).textContent = regionDelegates.length;
            });
        }

        // Load recent activities
        function loadRecentActivities() {
            const container = document.getElementById('recent-activities');
            container.innerHTML = '';
            
            // Combine recent reports and delegate activities
            const recentReports = reports
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);
            
            const activities = [];
            
            recentReports.forEach(report => {
                const delegate = delegates.find(d => d.id === report.delegateId);
                if (delegate) {
                    activities.push({
                        type: 'report',
                        title: 'Nouveau rapport envoyé',
                        description: `${delegate.prenom} ${delegate.nom} a envoyé un rapport`,
                        date: new Date(report.date)
                    });
                }
            });
            
            // Add some delegate activities
            const recentDelegates = delegates
                .sort((a, b) => new Date(b.dateAdded) - new Date(a.dateAdded))
                .slice(0, 2);
                
            recentDelegates.forEach(delegate => {
                activities.push({
                    type: 'delegate',
                    title: 'Nouveau délégué ajouté',
                    description: `${delegate.prenom} ${delegate.nom} - ${delegate.wilaya}`,
                    date: new Date(delegate.dateAdded)
                });
            });
            
            // Sort by date and take top 5
            activities.sort((a, b) => b.date - a.date).slice(0, 5).forEach(activity => {
                const alert = document.createElement('div');
                alert.className = 'alert alert-success';
                alert.innerHTML = `
                    <i class="fas fa-${activity.type === 'report' ? 'file-alt' : 'user-plus'}"></i>
                    <div class="alert-content">
                        <h4>${activity.title}</h4>
                        <div style="font-size: 0.9rem;">${activity.description} ${formatDate(activity.date)}</div>
                    </div>
                `;
                container.appendChild(alert);
            });
            
            if (activities.length === 0) {
                container.innerHTML = '<p>Aucune activité récente</p>';
            }
        }

        // Format date for display
        function formatDate(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffMinutes = Math.floor(diffMs / (1000 * 60));
            
            if (diffDays > 0) {
                return `il y a ${diffDays} jour${diffDays > 1 ? 's' : ''}`;
            } else if (diffHours > 0) {
                return `il y a ${diffHours} heure${diffHours > 1 ? 's' : ''}`;
            } else if (diffMinutes > 0) {
                return `il y a ${diffMinutes} minute${diffMinutes > 1 ? 's' : ''}`;
            } else {
                return 'à l\'instant';
            }
        }

        // Select region
        function selectRegion(region) {
            selectedRegion = region;
            
            // Update UI
            document.querySelectorAll('.region-card').forEach(card => {
                card.classList.remove('active');
            });
            document.querySelector(`.region-card[data-region="${region}"]`).classList.add('active');
            
            // Show region info
            document.getElementById('selected-region-info').style.display = 'block';
            
            // Load region details
            const regionDetails = document.getElementById('region-details');
            const regionDelegates = delegates.filter(d => d.region === region);
            const regionWilayas = wilayasByRegion[region];
            const regionReports = reports.filter(r => {
                const delegate = delegates.find(d => d.id === r.delegateId);
                return delegate && delegate.region === region;
            });
            
            regionDetails.innerHTML = `
                <div class="form-row">
                    <div class="form-group">
                        <label>Nombre de Wilayas</label>
                        <div class="form-control" style="background-color: #f5f5f5;">${regionWilayas.length}</div>
                    </div>
                    <div class="form-group">
                        <label>Nombre de Délégués</label>
                        <div class="form-control" style="background-color: #f5f5f5;">${regionDelegates.length}</div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Rapports Cette Semaine</label>
                        <div class="form-control" style="background-color: #f5f5f5;">${regionReports.length}</div>
                    </div>
                    <div class="form-group">
                        <label>Wilayas Couvertes</label>
                        <div class="form-control" style="background-color: #f5f5f5;">${[...new Set(regionDelegates.map(d => d.wilaya))].length}</div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Wilayas de la Région</label>
                    <div class="form-control" style="background-color: #f5f5f5; height: auto; min-height: 100px;">
                        ${regionWilayas.map(wilaya => `
                            <span style="display: inline-block; background: #e8f5e9; padding: 4px 8px; margin: 2px; border-radius: 4px; font-size: 0.9rem;">
                                ${wilaya}
                            </span>
                        `).join('')}
                    </div>
                </div>
                <div class="form-group">
                    <button class="btn btn-primary" onclick="showPage('liste-delegues')">
                        <i class="fas fa-users"></i> Voir les Délégués de cette Région
                    </button>
                </div>
            `;
            
            showToast(`Région ${getRegionName(region)} sélectionnée`, 'success');
        }

        // Get region name
        function getRegionName(region) {
            const names = {
                'nord': 'Nord',
                'sud': 'Sud', 
                'est': 'Est',
                'ouest': 'Ouest'
            };
            return names[region] || region;
        }

        // Load delegates grid
        function loadDelegatesGrid() {
            const container = document.getElementById('delegates-grid');
            container.innerHTML = '';
            
            if (delegates.length === 0) {
                container.innerHTML = '<p style="text-align: center; grid-column: 1 / -1;">Aucun délégué enregistré</p>';
                return;
            }
            
            delegates.forEach(delegate => {
                const delegateCard = document.createElement('div');
                delegateCard.className = 'delegate-card';
                delegateCard.setAttribute('data-region', delegate.region);
                delegateCard.setAttribute('data-wilaya', delegate.wilaya);
                
                delegateCard.innerHTML = `
                    <div class="delegate-header">
                        <div class="delegate-avatar">${delegate.prenom[0]}${delegate.nom[0]}</div>
                        <div class="delegate-info">
                            <h4>${delegate.prenom} ${delegate.nom}</h4>
                            <p>${delegate.wilaya} - ${getRegionName(delegate.region)}</p>
                        </div>
                    </div>
                    <div class="delegate-contact">
                        <p><i class="fas fa-phone"></i> ${delegate.telephone}</p>
                        <p><i class="fas fa-envelope"></i> ${delegate.email}</p>
                    </div>
                    <div class="delegate-stats">
                        <div class="delegate-stat">
                            <div class="value">${delegate.farmersCount}</div>
                            <div class="label">Fermiers</div>
                        </div>
                        <div class="delegate-stat">
                            <div class="value">${delegate.reportsCount}</div>
                            <div class="label">Rapports</div>
                        </div>
                    </div>
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button class="btn-action btn-view" onclick="viewDelegateReports(${delegate.id})">
                            <i class="fas fa-file-alt"></i> Voir Rapports
                        </button>
                        <button class="btn-action btn-view" onclick="viewDelegateFarmers(${delegate.id})">
                            <i class="fas fa-user-friends"></i> Voir Fermiers
                        </button>
                    </div>
                `;
                
                container.appendChild(delegateCard);
            });
        }

        // Filter delegates
        function filterDelegates() {
            const regionFilter = document.getElementById('filter-region-delegates').value;
            const wilayaFilter = document.getElementById('filter-wilaya-delegates').value;
            const searchTerm = document.getElementById('search-delegate').value.toLowerCase();
            
            const delegateCards = document.querySelectorAll('.delegate-card');
            
            delegateCards.forEach(card => {
                const region = card.getAttribute('data-region');
                const wilaya = card.getAttribute('data-wilaya');
                const name = card.querySelector('h4').textContent.toLowerCase();
                
                const matchesRegion = !regionFilter || region === regionFilter;
                const matchesWilaya = !wilayaFilter || wilaya === wilayaFilter;
                const matchesSearch = !searchTerm || name.includes(searchTerm);
                
                card.style.display = matchesRegion && matchesWilaya && matchesSearch ? '' : 'none';
            });
        }

        // Update wilayas filter based on selected region
        function updateWilayasFilter() {
            const regionFilter = document.getElementById('filter-region-delegates').value;
            const wilayaSelect = document.getElementById('filter-wilaya-delegates');
            
            // Reset to all wilayas
            wilayaSelect.innerHTML = '<option value="">Toutes les wilayas</option>';
            
            if (regionFilter) {
                const regionWilayas = wilayasByRegion[regionFilter];
                regionWilayas.forEach(wilaya => {
                    const option = document.createElement('option');
                    option.value = wilaya;
                    option.textContent = wilaya;
                    wilayaSelect.appendChild(option);
                });
            } else {
                allWilayas.forEach(wilaya => {
                    const option = document.createElement('option');
                    option.value = wilaya;
                    option.textContent = wilaya;
                    wilayaSelect.appendChild(option);
                });
            }
        }

        // Update delegates filter
        function updateDelegatesFilter() {
            const regionFilter = document.getElementById('filter-region-reports').value;
            const delegateSelect = document.getElementById('filter-delegate-reports');
            
            delegateSelect.innerHTML = '<option value="">Tous les délégués</option>';
            
            let filteredDelegates = delegates;
            if (regionFilter) {
                filteredDelegates = delegates.filter(d => d.region === regionFilter);
            }
            
            filteredDelegates.forEach(delegate => {
                const option = document.createElement('option');
                option.value = delegate.id;
                option.textContent = `${delegate.prenom} ${delegate.nom} - ${delegate.wilaya}`;
                delegateSelect.appendChild(option);
            });
        }

        // Load reports grid
        function loadReportsGrid() {
            const container = document.getElementById('reports-grid');
            container.innerHTML = '';
            
            if (reports.length === 0) {
                container.innerHTML = '<p style="text-align: center; grid-column: 1 / -1;">Aucun rapport envoyé</p>';
                return;
            }
            
            // Sort reports by date (newest first)
            const sortedReports = [...reports].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedReports.forEach(report => {
                const delegate = delegates.find(d => d.id === report.delegateId);
                if (!delegate) return;
                
                const reportCard = document.createElement('div');
                reportCard.className = 'report-card';
                reportCard.setAttribute('data-delegate', delegate.id);
                reportCard.setAttribute('data-region', delegate.region);
                reportCard.setAttribute('data-date', report.date);
                
                reportCard.innerHTML = `
                    <div class="report-header">
                        <div>
                            <div class="report-farmer">${report.farmerName || 'Fermier'}</div>
                            <div class="report-delegate">Par ${delegate.prenom} ${delegate.nom} - ${delegate.wilaya}</div>
                        </div>
                        <div class="report-date">${new Date(report.date).toLocaleDateString('fr-FR')}</div>
                    </div>
                    <div class="report-content">
                        <div class="report-description">
                            <strong>Description:</strong> ${report.description.substring(0, 100)}${report.description.length > 100 ? '...' : ''}
                        </div>
                        <div class="report-ordonnance">
                            <h5>Ordonnances:</h5>
                            ${report.ordonnances ? 
                                report.ordonnances.map(ordonnance => `
                                    <div><strong>${ordonnance.title}:</strong> ${ordonnance.content.substring(0, 50)}${ordonnance.content.length > 50 ? '...' : ''}</div>
                                `).join('') : 
                                `<div>${report.ordonnance.substring(0, 100)}${report.ordonnance.length > 100 ? '...' : ''}</div>`
                            }
                        </div>
                        ${report.photo ? `
                            <div class="report-photo">
                                <img src="${report.photo}" alt="Photo du rapport" style="cursor: pointer;" onclick="viewReport(${report.id})">
                            </div>
                        ` : ''}
                    </div>
                    <div style="margin-top: 15px; text-align: center;">
                        <button class="btn-action btn-view" onclick="viewReport(${report.id})">
                            <i class="fas fa-eye"></i> Voir Détails
                        </button>
                    </div>
                `;
                
                container.appendChild(reportCard);
            });
        }

        // Filter reports
        function filterReports() {
            const regionFilter = document.getElementById('filter-region-reports').value;
            const delegateFilter = document.getElementById('filter-delegate-reports').value;
            const dateFilter = document.getElementById('filter-date-reports').value;
            
            const reportCards = document.querySelectorAll('.report-card');
            
            reportCards.forEach(card => {
                const region = card.getAttribute('data-region');
                const delegate = card.getAttribute('data-delegate');
                const date = new Date(card.getAttribute('data-date'));
                
                const matchesRegion = !regionFilter || region === regionFilter;
                const matchesDelegate = !delegateFilter || delegate === delegateFilter;
                
                // Date filtering
                let matchesDate = true;
                if (dateFilter) {
                    const now = new Date();
                    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                    
                    if (dateFilter === 'today') {
                        matchesDate = date.getTime() === today.getTime();
                    } else if (dateFilter === 'week') {
                        const oneWeekAgo = new Date(today);
                        oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                        matchesDate = date >= oneWeekAgo;
                    } else if (dateFilter === 'month') {
                        const oneMonthAgo = new Date(today);
                        oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
                        matchesDate = date >= oneMonthAgo;
                    }
                }
                
                card.style.display = matchesRegion && matchesDelegate && matchesDate ? '' : 'none';
            });
        }

        // View report details
        function viewReport(reportId) {
            const report = reports.find(r => r.id === reportId);
            if (!report) return;
            
            const delegate = delegates.find(d => d.id === report.delegateId);
            const details = document.getElementById('report-details');
            
            details.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <strong>Délégué:</strong> ${delegate ? `${delegate.prenom} ${delegate.nom} - ${delegate.wilaya}` : 'Non spécifié'}
                </div>
                <div style="margin-bottom: 20px;">
                    <strong>Date:</strong> ${new Date(report.date).toLocaleDateString('fr-FR')}
                </div>
                <div style="margin-bottom: 20px;">
                    <strong>Description:</strong>
                    <div style="background: #f5f5f5; padding: 15px; border-radius: 6px; margin-top: 5px;">
                        ${report.description}
                    </div>
                </div>
                <div style="margin-bottom: 20px;">
                    <strong>Ordonnances:</strong>
                    <div style="background: #f5f5f5; padding: 15px; border-radius: 6px; margin-top: 5px;">
                        ${report.ordonnances ? 
                            report.ordonnances.map(ordonnance => `
                                <div style="margin-bottom: 10px;">
                                    <strong>${ordonnance.title}:</strong>
                                    <div>${ordonnance.content}</div>
                                </div>
                            `).join('') : 
                            `<div>${report.ordonnance}</div>`
                        }
                    </div>
                </div>
                ${report.photo ? `
                    <div style="margin-bottom: 20px;">
                        <strong>Photo:</strong>
                        <div style="text-align: center; margin-top: 10px;">
                            <img src="${report.photo}" alt="Photo du rapport" style="max-width: 100%; max-height: 400px; border-radius: 6px;">
                        </div>
                    </div>
                ` : ''}
            `;
            
            document.getElementById('viewReportModal').style.display = 'flex';
        }

        // View delegate reports
        function viewDelegateReports(delegateId) {
            showPage('rapports-delegues');
            document.getElementById('filter-delegate-reports').value = delegateId;
            filterReports();
            
            document.querySelectorAll('.sidebar-menu li').forEach(item => item.classList.remove('active'));
            document.querySelector('.sidebar-menu a[href="#rapports-delegues"]').parentElement.classList.add('active');
        }

        // View delegate farmers
        function viewDelegateFarmers(delegateId) {
            showPage('liste-fermiers');
            document.getElementById('filter-delegate-farmers').value = delegateId;
            loadFarmersByDelegate();
            
            document.querySelectorAll('.sidebar-menu li').forEach(item => item.classList.remove('active'));
            document.querySelector('.sidebar-menu a[href="#liste-fermiers"]').parentElement.classList.add('active');
        }

        // Load delegates for farmers filter
        function loadDelegatesForFarmers() {
            const delegateSelect = document.getElementById('filter-delegate-farmers');
            delegateSelect.innerHTML = '<option value="">Sélectionner un délégué</option>';
            
            delegates.forEach(delegate => {
                const option = document.createElement('option');
                option.value = delegate.id;
                option.textContent = `${delegate.prenom} ${delegate.nom} - ${delegate.wilaya}`;
                delegateSelect.appendChild(option);
            });
        }

        // Load farmers by delegate
        function loadFarmersByDelegate() {
            const delegateId = document.getElementById('filter-delegate-farmers').value;
            const regionFilter = document.getElementById('filter-region-farmers').value;
            const container = document.getElementById('farmers-list');
            container.innerHTML = '';
            
            let filteredFarmers = farmers;
            
            if (delegateId) {
                // In a real app, you would filter farmers by delegate
                // For demo, we'll show all farmers
                filteredFarmers = farmers;
            }
            
            if (regionFilter) {
                filteredFarmers = filteredFarmers.filter(farmer => {
                    const delegate = delegates.find(d => d.id === farmer.delegateId);
                    return delegate && delegate.region === regionFilter;
                });
            }
            
            if (filteredFarmers.length === 0) {
                container.innerHTML = '<p style="text-align: center; grid-column: 1 / -1;">Aucun fermier trouvé</p>';
                return;
            }
            
            filteredFarmers.forEach(farmer => {
                const delegate = delegates.find(d => d.id === farmer.delegateId);
                
                const farmerCard = document.createElement('div');
                farmerCard.className = 'farmer-card';
                farmerCard.setAttribute('data-delegate', farmer.delegateId);
                
                farmerCard.innerHTML = `
                    <div class="farmer-header">
                        <div class="farmer-avatar">${farmer.prenom[0]}${farmer.nom[0]}</div>
                        <div class="farmer-info">
                            <h4>${farmer.prenom} ${farmer.nom}</h4>
                            <p>${delegate ? `Délégué: ${delegate.prenom} ${delegate.nom}` : 'Aucun délégué'}</p>
                        </div>
                    </div>
                    <div class="farmer-details">
                        <div class="farmer-detail">
                            <span class="label">Téléphone:</span>
                            <span class="value">${farmer.telephone}</span>
                        </div>
                        <div class="farmer-detail">
                            <span class="label">Wilaya:</span>
                            <span class="value">${farmer.wilaya || 'Non spécifiée'}</span>
                        </div>
                        <div class="farmer-detail">
                            <span class="label">Surface:</span>
                            <span class="value">${farmer.surface} hectares</span>
                        </div>
                        <div class="farmer-detail">
                            <span class="label">Type de culture:</span>
                            <span class="value">${farmer.typeCulture}</span>
                        </div>
                    </div>
                `;
                
                container.appendChild(farmerCard);
            });
        }

        // Filter farmers by delegate
        function filterFarmersByDelegate() {
            const searchTerm = document.getElementById('search-farmer-delegate').value.toLowerCase();
            const farmerCards = document.querySelectorAll('.farmer-card');
            
            farmerCards.forEach(card => {
                const name = card.querySelector('h4').textContent.toLowerCase();
                const matchesSearch = !searchTerm || name.includes(searchTerm);
                card.style.display = matchesSearch ? '' : 'none';
            });
        }

        // Export reports to PDF
        function exportReportsToPDF() {
            // In a real app, you would generate a PDF
            // For demo, we'll just show a success message
            showToast('Export PDF en cours de préparation...', 'success');
            
            // Simulate PDF generation
            setTimeout(() => {
                showToast('PDF exporté avec succès!', 'success');
            }, 2000);
        }

        // Update profile
        function updateProfile() {
            const nom = document.getElementById('profile-nom').value;
            const prenom = document.getElementById('profile-prenom').value;
            const email = document.getElementById('profile-email').value;
            const telephone = document.getElementById('profile-telephone').value;
            const region = document.getElementById('profile-region').value;
            
            // In a real app, you would save this to a backend
            showToast('Profil mis à jour avec succès!', 'success');
        }

        // Update password
        function updatePassword() {
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                showToast('Veuillez remplir tous les champs', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showToast('Les mots de passe ne correspondent pas', 'error');
                return;
            }
            
            // In a real app, you would verify the current password and update it
            showToast('Mot de passe mis à jour avec succès!', 'success');
            document.getElementById('security-form').reset();
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                <div class="toast-content">
                    <h4>${type === 'success' ? 'Succès' : 'Erreur'}</h4>
                    <p>${message}</p>
                </div>
            `;
            
            container.appendChild(toast);
            
            // Remove toast after 5 seconds
            setTimeout(() => {
                toast.style.animation = 'toastSlideIn 0.3s reverse';
                setTimeout(() => {
                    container.removeChild(toast);
                }, 300);
            }, 5000);
        }
    </script>
</body>
</html>